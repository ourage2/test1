(function(e){e.subscribe("theme.change",function(b){e.loadCss("/css/"+b.themeName+"/contextmenu.css")});var l=e.storage.get("window.theme");e.isNull(l)&&(l="default");e.loadCss("/css/"+l+"/contextmenu.css");e.contextmenu={shadow:!0,shadowOffset:0,shadowOffsetX:5,shadowOffsetY:5,shadowWidthAdjust:-3,shadowHeightAdjust:-3,shadowOpacity:.2,shadowClass:"context-menu-shadow",shadowColor:"black",offsetX:0,offsetY:0,appendTo:"body",direction:"down",constrainToScreen:!0,showTransition:"show",hideTransition:"hide",
showSpeed:null,hideSpeed:null,showCallback:null,hideCallback:null,className:"context-menu",itemClassName:"context-menu-item",itemHoverClassName:"context-menu-item-hover",disabledItemClassName:"context-menu-item-disabled",disabledItemHoverClassName:"context-menu-item-disabled-hover",separatorClassName:"context-menu-separator",innerDivClassName:"context-menu-item-inner",themePrefix:"context-menu-theme-",theme:"default",separator:"context-menu-separator",target:null,menu:null,shadowObj:null,bgiframe:null,
shown:!1,create:function(b,d){var a=jQuery.extend({},this,d);"string"==typeof b?a.menu=jQuery(b):"function"==typeof b?a.menuFunction=b:a.menu=a.createMenu(b,a);a.menu&&(a.menu.css({display:"none"}),jQuery(a.appendTo).append(a.menu));a.shadow&&(a.createShadow(a),a.shadowOffset&&(a.shadowOffsetX=a.shadowOffsetY=a.shadowOffset));jQuery("body").bind("contextmenu",function(){a.hide()});return a},createIframe:function(){return jQuery('<iframe frameborder="0" tabindex="-1" src="javascript:false" style="display:block;position:absolute;z-index:-1;filter:Alpha(Opacity=0);"/>')},
createMenu:function(b,d){var a=d.className;e.foreach(d.theme.split(","),function(b,c){a+=" "+d.themePrefix+c});for(var c=jQuery("<table cellspacing=0 cellpadding=0></table>").click(function(){d.hide();return!1}),f=jQuery("<tr></tr>"),g=jQuery("<td></td>"),m=jQuery('<div class="'+a+'"></div>'),h=0;h<b.length;h++)if(b[h]==e.contextmenu.separator)m.append(d.createSeparator());else for(var k in b[h])m.append(d.createMenuItem(k,b[h][k]));c.append(f.append(g.append(m)));e.behavior.IApplyBlockUI&&e.behavior.IApplyBlockUI(g,
!0,{callWidget:"contextmenu",type:"content"});return c},createMenuItem:function(b,d){var a=this;"function"==typeof d&&(d={onclick:d});var c=jQuery.extend({onclick:function(){},className:"",hoverClassName:a.itemHoverClassName,icon:"",disabled:!1,title:"",hoverItem:a.hoverItem,hoverItemOut:a.hoverItemOut},d),f=c.icon?"background-image:url("+c.icon+");":"",g=jQuery('<div class="'+a.itemClassName+" "+c.className+(c.disabled?" "+a.disabledItemClassName:"")+'" title="'+c.title+'"></div>').click(function(b){return a.isItemDisabled(this)?
!1:c.onclick.call(a.target,this,a,b)}).bind({mouseenter:function(){c.hoverItem.call(this,a.isItemDisabled(this)?a.disabledItemHoverClassName:c.hoverClassName)},mouseleave:function(){c.hoverItemOut.call(this,a.isItemDisabled(this)?a.disabledItemHoverClassName:c.hoverClassName)}}),f=jQuery('<div class="'+a.innerDivClassName+'" style="'+f+'">'+b+"</div>");g.append(f);return g},createSeparator:function(){return jQuery('<div class="'+this.separatorClassName+'"></div>')},isItemDisabled:function(b){return jQuery(b).is("."+
this.disabledItemClassName)},hoverItem:function(b){jQuery(this).addClass(b)},hoverItemOut:function(b){jQuery(this).removeClass(b)},createShadow:function(b){b.shadowObj=jQuery('<div class="'+b.shadowClass+'"></div>').css({display:"none",position:"absolute",zIndex:9998,opacity:b.shadowOpacity,backgroundColor:b.shadowColor});jQuery(b.appendTo).append(b.shadowObj)},showShadow:function(b,d,a){if(this.shadow)this.shadowObj.css({width:this.menu.width()+this.shadowWidthAdjust+"px",height:this.menu.height()+
this.shadowHeightAdjust+"px",top:d+this.shadowOffsetY+"px",left:b+this.shadowOffsetX+"px"}).addClass(this.shadowClass)[this.showTransition](this.showSpeed)},beforeShow:function(){return!0},show:function(b,d){var a=this,c=d.pageX,f=d.pageY;a.target=b;if(!1!==a.beforeShow()){a.menuFunction&&(a.menu&&jQuery(a.menu).remove(),a.menu=a.createMenu(a.menuFunction(a,b),a),a.menu.css({display:"none"}),jQuery(a.appendTo).jq.append(a.menu));var g=a.menu,c=c+a.offsetX,f=f+a.offsetY,c=a.getPosition(c,f,a,d);a.showShadow(c.x,
c.y,d);g.css({top:c.y+"px",left:c.x+"px",position:"absolute",zIndex:9999})[a.showTransition](a.showSpeed,a.showCallback?function(){a.showCallback.call(a)}:null);a.shown=!0;jQuery(document).one("click",null,function(){a.hide()})}},getPosition:function(b,d,a,c){b+=a.offsetX;d+=a.offsetY;c=a.menu.height();var f=a.menu.width(),g=a.direction;if(a.constrainToScreen){var e=jQuery(window),h=e.height(),k=e.width();"down"==g&&d+c-e.scrollTop()>h&&(g="up");f=b+f-e.scrollLeft();f>k&&(b-=f-k)}"up"==g&&(d-=c);
a.shadow&&(b-=a.shadowOffsetX,d-=a.shadowOffsetY);return{x:b,y:d}},hide:function(){var b=this;if(b.shown){b.iframe&&jQuery(b.iframe).hide();if(b.menu)b.menu[b.hideTransition](b.hideSpeed,b.hideCallback?function(){b.hideCallback.call(b)}:null);if(b.shadow)b.shadowObj[b.hideTransition](b.hideSpeed)}b.shown=!1}}})(naw);