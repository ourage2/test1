(function(l){naw.namespace("tabs");naw.tabs={conf:{_tHeaderSelector:".tab-header:first > ul li",_tContentSelector:".tab-body:first > .tab-content",_autoScroll:!1,_ms_scroll_button_height:"20px",width:null,height:null,autoHeight:!1,active:0,event:"click",onTabClick:null,onTabChange:null,onTabDblClick:null,showTabScroll:!1,autoScroll:!1,headerStruct:null}};var p=naw.plugin.Base.extend({init:function(a,b){this.setName("tab");this._super("tab");this.conf=b;this.root=a;this.tabs=a.find(b._tHeaderSelector);
this.contents=a.find(b._tContentSelector);this.active=this.tabs.eq(b.active);this.activeContent=this.contents.eq(b.active);this.mobileInitFlag=!1;var c=[];this.isMobile&&(this.autoScroll=b.showTabScroll=!1);this.autoScroll&&(b.showTabScroll=!1);var d=this,e=d.root.find("div.tab-header:first"),f=e.find("> ul:first");d.tabs.each(function(a){this.setAttribute("data-index",a)});d.id=d.root[0].id;d.root.off();d.root.removeClass("x-tab-scrolling");1==d.root.find(" > div.tab-header-wrap").length&&e.unwrap();
e.siblings("[class^=tab-scroller]").remove();e.removeAttr("style");f.removeAttr("style");d.tabs.removeClass();d.blinkArr=[];d.tabs.each(function(a){jQuery(this).find("> a:first").attr("href","#");d.blinkArr.push(void 0);c.push(this.id)});d.root.removeClass("position-left");d.root.children().eq(0).removeClass("tab-header-wrap-left").end().eq(1).removeClass("tab-body-right");naw.subscribe("theme.change",function(a){d.changeTheme(a.themeName,a.themeBasePath)});this._eventBind();this._behavior();if(b.headerStruct&&
(e=b.headerStruct.position)){var g,h,k;"left"==e?(g="position-left",h="tab-header-wrap-left",k="tab-body-right"):"right"==e?(g="position-right",h="tab-header-wrap-right",k="tab-body-left"):"bottom"==e&&(g="position-bottom",h="tab-header-wrap-bottom",k="tab-body-top");d.root.addClass(g);d.root.children().eq(0).addClass(h).end().eq(1).addClass(k);if("left"==e||"right"==e)b.headerStruct.height&&(g=parseInt(f.find("> li > a > em > span:first").css("font-size")),g=parseInt(b.headerStruct.height)-g-2,f.find("> li > a > em > span").css("padding",
g/2+"px 1em "+(g/2+2)+"px 1em")),b.headerStruct.width&&f.find("> li > a > em > span").css("width",parseInt(b.headerStruct.width)+"px")}b.width&&this._width(b.width);b.height&&this._height(b.height);b.showTabScroll&&this._createScroller();this.height=function(a){this._height(a);naw.publish("window.resize",null)};b.autoHeight&&(maxHeight=0,this.contents.each(function(){maxHeight=Math.max(maxHeight,jQuery(this).height("").height())}).height(maxHeight));d.contents.unbind("errFieldEvent");d.contents.bind("errFieldEvent",
function(a,b){var c=jQuery(this).index(),e=d.tabs.eq(c);e.addClass("state-err state-blink");var f=void 0;"msie"==naw.agent.browser&&10>parseInt(naw.agent.version)&&void 0==d.blinkArr[c]&&(f=setInterval(function(){e.fadeToggle(400)},400),d.blinkArr[c]=f);c=e.data("errInfo");void 0==c&&(c={});c[a.target.id]=b;e.data("errInfo",c)});this.active.addClass("state-current");this.activeContent.show().siblings(".tab-content").hide();this.activeContent.attr("data-url")&&0==this.activeContent.children().length&&
(f=this.activeContent.attr("data-url"),naw.division.load({url:f,selector:this.activeContent.get(0),appendType:"append"}));this.isComplete&&naw.publish("window.resize",null);b.autoScroll&&(d=this,l.subscribe("window.resize",function(a){d._tabResize()}));naw.behavior.IWidgetApplyAuth&&naw.behavior.IWidgetApplyAuth(this,c)},_eventBind:function(){for(var a=["tabClick","tabChange","tabDblClick"],b=0,c=a.length;b<c;b++){var d=a[b];this[d]=function(a,b){return function(c){a.conf["on"+b.substring(0,1).toUpperCase()+
b.substr(1)]=c}}(this,d)}},_behavior:function(){var a=this,b=a.conf;a.root.attr("id");var c=a.root.find(".tab-header:first").wrap('<div class="tab-header-wrap"></div>');jQuery(c).on("mouseover","a",function(a){a=jQuery(this);var b=a.parent();a.hasClass("state-disabled")||b.addClass("state-hover")}).on("mouseout","a",function(a){a=jQuery(this);var b=a.parent();a.hasClass("state-disabled")||b.removeClass("state-hover")}).on("click","a",function(b){var c=jQuery(this);c.parent();a._clickHandler(c.parent().index());
return b.preventDefault()}).on("dblclick","a",function(a){a=jQuery(this);a.parent();if("function"==typeof b.onTabDblClick)b.onTabDblClick(a.parent().index())});if(this.isMobile){var c=navigator.userAgent.toLowerCase(),d=a.root.find("div.tab-header:first").get(0);l.isMobileMode||!c||-1==c.indexOf("ipad")&&-1==c.indexOf("ipod")&&-1==c.indexOf("iphone")?(d.style.width="100%",d.style.overflowX="auto",b.headerStruct&&b.headerStruct.position||jQuery(d).find(" > ul:first").width(5E3)):(d.style.width="100%",
d.style.overflowX="auto",b.headerStruct&&b.headerStruct.position||(jQuery(d).find(" > ul:first").width(5E3),tmpRootWidth=jQuery(a.root).width(),tmpRootWidth=0==tmpRootWidth?"100%":tmpRootWidth+"px",d.style.width=tmpRootWidth));jQuery(d).bind("touchstart",function(b){a.mobileInitFlag||(a.mobileInitFlag=!0,a._mobileResize())})}return a},_width:function(a){this.root.css("width",a);return this},_height:function(a){this.contents.parent().css("height",a);return this},_mobileWidth:function(a){var b=this.root.find(".tab-header:first ul:first");
jQuery(b).width(jQuery(b).width()+a);return this},_mobileResize:function(){var a=this.conf,b=0;if(a.headerStruct&&"left"==a.headerStruct.position)return!1;this.tabs.each(function(a){a=jQuery(this);a.hasClass("state-hide")||(b+=a.width())});this.root.find(".tab-header:first ul:first").width(b+1);return this},_tabResize:function(){var a=this.conf,b=this.tabs;if(a.showTabScroll){for(var c=0,d=jQuery(this.root).find("div .tab-header:first").width(),e=0,f=b.length;e<f;e++)c+=jQuery(b[e]).width();d>c&&
(a.showTabScroll=!1,this._removeScroller())}else{for(var c=0,d=jQuery(this.root).width(),e=0,f=b.length;e<f;e++)c+=jQuery(b[e]).width();d<c&&(a.showTabScroll=!0,this._createScroller())}},_removeScroller:function(){var a=this.root.find(".tab-header:first"),b=a.find("> ul:first");this.root.removeClass("x-tab-scrolling");a.siblings("[class^=tab-scroller]").remove();a.removeAttr("style");b.removeAttr("style")},_createScroller:function(){var a=this,b=a.conf;if(!b.showTabScroll)return a;naw._require("naw.thirdparty.scrollto",
function(){a.root.addClass("x-tab-scrolling");a.root.find(".tab-header:first").before('<div class="tab-scroller-left"></div>').after('<div class="tab-scroller-right"></div>');a.root.find(".tab-scroller-left:first").addClass("state-disabled").hover(function(a){jQuery(this).hasClass("state-disabled")||jQuery(this).addClass("state-hover")},function(a){jQuery(this).hasClass("state-disabled")||jQuery(this).removeClass("state-hover")}).bind("click",function(b){jQuery(this).hasClass("state-disabled")||a._onScrollLeft.call(a,
b)}).end().find(".tab-scroller-right:first").addClass("state-disabled").hover(function(a){jQuery(this).hasClass("state-disabled")||jQuery(this).addClass("state-hover")},function(a){jQuery(this).hasClass("state-disabled")||jQuery(this).removeClass("state-hover")}).bind("click",function(b){jQuery(this).hasClass("state-disabled")||a._onScrollRight.call(a,b)});a.tabs.parent().width(a._calculateScrollArea());b.showTabScroll&&b._autoScroll&&a._scrollToTab(a.active);return a})},_clickHandler:function(a,
b){var c=this,d=c.conf,e=c.tabs.eq(a),f=c.contents.eq(a),g=e===c.active,h=-1;if(!e.hasClass("state-disabled")&&!g){e.addClass("state-current").siblings("li.state-current").removeClass("state-current");f.show().siblings(".tab-content").hide();h=c.active.index();c.active=e;c.activeContent=f;this.activeContent.attr("data-url")&&0==this.activeContent.children().length&&(e=this.activeContent.attr("data-url"),naw.division.load({url:e,selector:this.activeContent.get(0),appendType:"append"}));d.showTabScroll&&
d._autoScroll&&c._scrollToTab(c.active);naw.publish("window.resize",null,"tabClick");e=jQuery.Event();e.type="tabclick";c.root.trigger(e,[{index:a,jq:f,dom:f.get(0),title:function(b){if(b)c.setTitle(a,b);else return c.getTitle(a)},css:function(){arguments.length&&f.css(arguments[0],arguments[1])}}]);e=c.tabs.eq(a).data("errInfo");if(void 0!=e){for(var k in e)naw("#"+k).errField(e[k]),delete e[k];e=null;k=c.blinkArr[a];void 0!=k&&(clearInterval(k),c.tabs.eq(a).stop().fadeTo(200,1),c.blinkArr[a]=void 0);
c.tabs.eq(a).removeClass("state-err state-blink").removeData("errInfo").end()}if(!b||!b.pass){if(a!=h&&"function"==typeof d.onTabChange)d.onTabChange(a,h);if("function"==typeof d.onTabClick)d.onTabClick(a,h)}}},_scrollTo:function(a){var b=this;__updateScrollButton=function(){var a=b._getScrollPos(),d=b._getScrollWidth(),e=b._getScrollArea();b.root.find(".tab-scroller-left:first")[0==a?"addClass":"removeClass"]("state-disabled");b.root.find(".tab-scroller-right:first")[a>=d-e?"addClass":"removeClass"]("state-disabled")};
-1<a&&b.root.find(".tab-header:first").scrollTo(a,100,{axis:"x",margin:"false"});-1<a&&b.root.find(".tab-header:first").scrollTo(a,100,{axis:"x",margin:"false"});__updateScrollButton(a)},_scrollToTab:function(a){a&&this._scrollTo(a.position().left)},_onScrollRight:function(){var a=this._getScrollWidth()-this._getScrollArea(),b=this._getScrollPos(),c=this._getCurrentEle("right"),a=Math.min(a,b+this._getScrollIncrement(c)+this._getTabMargin());a!=b?this._scrollTo(a):this._scrollTo(-1)},_onScrollLeft:function(){var a=
this._getCurrentEle("left");this._scrollToTab(a)},_getCurrentEle:function(a){var b=jQuery(""+this.root.selector+" .tab-header:first ul:first"),c=Math.abs(b.position().left),d=-1;b.find(" > li").each(function(b){if("right"==a){if(jQuery(this).position().left>=c)return d=b,!1}else if("left"==a&&jQuery(this).position().left+jQuery(this).outerWidth(!0)>=c)return d=jQuery(this),!1});return d},_getScrollPos:function(){return this.root.find(".tab-header:first").get(0).scrollLeft},_getScrollWidth:function(){return this.root.find(".tab-header:first").get(0).scrollWidth},
_getScrollArea:function(){return this.root.find(".tab-header:first").get(0).clientWidth},_getScrollIncrement:function(a){return this.root.find(".tab-header:first ul:first > li").eq(a).outerWidth(!0)},_getTabMargin:function(){return parseInt(this.tabs.eq(0).css("margin-left"),10)},_calculateScrollArea:function(){var a=this.tabs,b=this._getTabMargin(),c=0;this.tabs.parent().width(5E3);a.each(function(a){jQuery(this).hasClass("state-hide")||(c+=jQuery(this).outerWidth(!0))});c+=b*a.length;c+=1;this.conf._autoScroll||
(this.conf._autoScroll=!0);return c},setCurrentTab:function(a,b){var c=this.tabs.eq(a),d={pass:!1};b&&(d.pass=!0);this._clickHandler(a,d);this.isMobile&&jQuery(c).get(0).scrollIntoView(!0);return this},getCurrentTab:function(){return this.tabs.index(this.active)},setTitle:function(a,b){var c=this.conf,d=this.tabs.eq(a),e=d.width(),f;d.find("a>em>span:first").text(b);this.isMobile&&(f=d.width(),this._mobileWidth(f-e));c.showTabScroll&&c._autoScroll&&d.parent().css("width",this._calculateScrollArea());
return this},getTitle:function(a){return"undefined"==typeof a||0>a?"":this.tabs.eq(a).find("a>em>span:first").text()},insertContents:function(a,b,c){var d=this,e=d.conf,f=d.root,g=f.children(".tab-header-wrap, .tab-body"),h=jQuery(g[0].firstChild).children("ul"),g=jQuery(g[1]),k=jQuery("<li></li>"),m=jQuery("<a href='javascript:void(0)'></a>"),n=jQuery("<em></em>"),l=jQuery("<span></span>");n.append(l);m.append(n);k.append(m);c&&l.text(c);0<h.children().eq(b).length?h.children().eq(b).before(k):h.append(k);
a=jQuery("<div id='"+a+"' class='tab-content' style='display:none;' ></div>");0<g.children().eq(b).length?g.children().eq(b).before(a):g.append(a);d.tabs=f.find(e._tHeaderSelector);d.contents=f.find(e._tContentSelector);0<d.tabs.length&&f.show();d.blinkArr=[];d.tabs.each(function(a){this.setAttribute("data-index",a);d.blinkArr.push(void 0)});return!0},removeContents:function(a){var b=this,c=b.conf,d=b.root,e=d.children(".tab-header-wrap, .tab-body"),f=jQuery(e[0].firstChild).children("ul"),e=jQuery(e[1]);
if(0<f.children().eq(a).length)f.children().eq(a).remove();else return!1;if(0<e.children().eq(a).length)e.children().eq(a).remove();else return!1;b.tabs=d.find(c._tHeaderSelector);b.contents=d.find(c._tContentSelector);0==b.tabs.length&&d.hide();b.blinkArr=[];b.tabs.each(function(a){this.setAttribute("data-index",a);b.blinkArr.push(void 0)});return!0},removeContentHtml:function(a){this.contents.eq(a).children().remove();return!0},getContentsCnt:function(){return this.tabs.length},disabledTab:function(a){var b=
[];jQuery.isArray(a)?b=b.concat(a):b.push(a);for(i in b)this.tabs.eq(b[i]).addClass("state-disabled");return this},enabledTab:function(a){var b=[];jQuery.isArray(a)?b=b.concat(a):b.push(a);for(i in b)a=this.tabs.eq(b[i]),0!=a.length&&!1!==a.data("auth")&&this.tabs.eq(b[i]).removeClass("state-disabled");return this},getDisabledTab:function(a){if(isNaN(a)){var b=[];this.tabs.each(function(a){l(this).hasClass("state-disabled")&&b.push(a)});return b}a=parseInt(a);return this.tabs.eq(a).hasClass("state-disabled")?
!0:!1},titleAuthDisable:function(a){var b=this,c=b.tabs,d=!1;if(void 0==a)return!1;var e=function(a){var b=null;if(isNaN(a)){if(c.each(function(c){this.id==a&&(b=jQuery(this))}),null==b)return!1}else{var e=parseInt(a);if(0==c.eq(e).length)return!1;b=c.eq(e)}b.addClass("state-disabled");b.data("auth",!1);b.hasClass("state-current")&&(d=!0)};0==jQuery.isArray(a)&&(a=[a]);for(var f=a.length,g=0;g<f;g++)e(a[g]);1==d&&c.each(function(a){var c=jQuery(this);if(!c.hasClass("state-hide")&&!c.hasClass("state-disabled"))return b.setCurrentTab(a),
!1});return!0},titleAuthEnable:function(a){var b=this.tabs;if(void 0==a)return!1;var c=function(a){var c=null;if(isNaN(a)){if(b.each(function(b){this.id==a&&(c=jQuery(this))}),null==c)return!1}else{var d=parseInt(a);if(0==b.eq(d).length)return!1;c=b.eq(d)}c.removeClass("state-disabled");c.removeData("auth")};0==jQuery.isArray(a)&&(a=[a]);for(var d=a.length,e=0;e<d;e++)c(a[e]);return!0},hideTab:function(a){var b=this.tabs,c=[],d=!1;jQuery.isArray(a)?c=c.concat(a):c.push(a);for(i in c)b.eq(c[i]).hasClass("state-current")&&
(b.eq(c[i]).removeClass("state-current"),d=!0),b.eq(c[i]).addClass("state-hide");1==d&&(c=jQuery(".tab-header:first > ul > li:not(.state-hide)",this.root).index(),this.setCurrentTab(c));c=this.conf;a=b.eq(a);this.isMobile&&this._mobileResize();c.showTabScroll&&c._autoScroll&&a.parent().css("width",this._calculateScrollArea());return this},showTab:function(a){var b=this.tabs,c=[];jQuery.isArray(a)?c=c.concat(a):c.push(a);for(i in c)!1!==b.eq(c[i]).data("auth")&&b.eq(c[i]).removeClass("state-hide");
c=this.conf;a=b.eq(a);this.isMobile&&this._mobileResize();c.showTabScroll&&c._autoScroll&&a.parent().css("width",this._calculateScrollArea());return this},authHideTab:function(a){var b=this,c=b.tabs,d=b.conf,e=!1;if(void 0==a)return!1;var f=function(a){var b=null;if(isNaN(a)){if(c.each(function(c){this.id==a&&(b=jQuery(this))}),null==b)return!1}else{var d=parseInt(a);if(0==c.eq(d).length)return!1;b=c.eq(d)}b.addClass("state-hide");b.data("auth",!1);b.hasClass("state-current")&&(e=!0)};0==jQuery.isArray(a)&&
(a=[a]);for(var g=a.length,h=0;h<g;h++)f(a[h]);1==e&&c.each(function(a){var c=jQuery(this);if(!c.hasClass("state-hide")&&!c.hasClass("state-disabled"))return b.setCurrentTab(a),!1});b.isMobile&&b._mobileResize();d.showTabScroll&&d._autoScroll&&tab.parent().css("width",b._calculateScrollArea());b.getHideTab().length==c.length&&b.root.hide();return!0},authShowTab:function(a){var b=this.tabs;if(void 0==a)return!1;var c=function(a){var c=null;if(isNaN(a)){if(b.each(function(b){this.id==a&&(c=jQuery(this))}),
null==c)return!1}else{var d=parseInt(a);if(0==b.eq(d).length)return!1;c=b.eq(d)}c.removeClass("state-hide");c.removeData("auth")};0==jQuery.isArray(a)&&(a=[a]);for(var d=a.length,e=0;e<d;e++)c(a[e]);a=this.getHideTab();c=a.length;if(c<b.length&&0==this.root.is(":visible")){this.root.show();for(var d=this.active.index(),f=!1,e=0;e<c;e++)if(d==a[e]){f=!0;break}1==f&&(e=jQuery(".tab-header:first > ul > li:not(.state-hide)",this.root).index(),this.setCurrentTab(e))}this.isMobile&&this._mobileResize();
this.showTabScroll&&this._autoScroll&&tab.parent().css("width",this._calculateScrollArea());return!0},getHideTab:function(a){if(isNaN(a)){var b=[];this.tabs.each(function(a){l(this).hasClass("state-hide")&&b.push(a)});return b}a=parseInt(a);return this.tabs.eq(a).hasClass("state-hide")?!0:!1},removeErrDisplay:function(a){var b=this,c=function(a){var c=b.tabs.eq(a).data("errInfo");if(void 0!=c){for(var d in c)naw("#"+d).errField(c[d]),delete c[d];c=b.blinkArr[a];void 0!=c&&(clearInterval(c),b.tabs.eq(a).stop().fadeTo(200,
1),b.blinkArr[a]=void 0);b.tabs.eq(a).removeClass("state-err state-blink").removeData("errInfo").end()}};if(void 0==a){a=0;for(var d=b.tabs.length;a<d;a++)c(a)}else isNaN(a)||c(parseInt(a))},isLoadDivision:function(a){var b=this.contents;if(!b[a])return!1;a=jQuery(b[a]);return a.attr("data-url")?0<a.children().length?!0:!1:!1}});naw._addFunction(!0,{tabs:function(a){var b=this.jq.get(0).widget;b||(a||(a={}),a=jQuery.extend({},naw.tabs.conf,a),b=new p(this.jq,a),this.jq.get(0).widget=b);return b}})})(naw);