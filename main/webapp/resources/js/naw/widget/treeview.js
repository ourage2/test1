(function(g){g.namespace("widget.treeview");g.widget.treeview=g.widget.Base.extend({init:function(a,b){this.setName("treeview");this._super();this.height=this.width=100;this.DumpData=[];this.selectedIndex={key:"",data:{}};this.expandedIndex={key:"",data:{}};this.multiCheckAutoLeaf=this.multiCheck=!1;this.ref=[];this.rootString="";this.nodeArr=[];this.nodeArrLen=0;this.treeIcon={parent:"",leaf:"",root:""};this.selectTreeIcon={parent:"",leaf:"",root:""};this.subNodeKey=this.titleKey=this.key="";this.bMakeSubKey=
!1;this.separate="";this.DumpData=[];this.treeviewMain=null;this.onCheck=this.onExpand=this.onSelect="";treeviewStruct=this._getTemplate(a);this.divID="";this.autoExpand=this.showRootDepth=!0;this.css={click:{"font-weight":"bold",color:"#ef3e42"},unclick:{"font-weight":"",color:""}};if("object"!=typeof treeviewStruct){var c=(new Function("return "+treeviewStruct))();this.makeParam(c)}else this.makeParam(treeviewStruct);this.create(b.id)},create:function(a){this.divID="inner-"+a;0<document.getElementById(a).childNodes.length&&
jQuery("#"+a).children().remove();var b="<div class='inner-treeview-pnl' id='inner-"+a+"' ></div>";jQuery("#"+a).append(b);jQuery("#inner-"+a).css("width",this.width);jQuery("#inner-"+a).css("height",this.height);this.maxHeight&&(jQuery("#inner-"+a).css({"max-height":this.maxHeight}),"msie"==g.agent.browser&&9>parseInt(g.agent.version)&&jQuery("#inner-"+a).css({overflow:"visible"}));this.makeTreeView();this.treeEvt();a=["select","expand","dblClick","check"];for(var b=0,c=a.length;b<c;b++){var d=a[b];
this[d]=function(a,b){return function(c){a["on"+b.substring(0,1).toUpperCase()+b.substr(1)]=c}}(this,d)}},makeParam:function(a){"undefined"!=typeof a.width&&(this.width=a.width);"undefined"!=typeof a.height&&(this.height=a.height);"undefined"!=typeof a.maxHeight&&(this.maxHeight=-1!=a.maxHeight.indexOf("px")?a.maxHeight:a.maxHeight+"px");"undefined"!=typeof a.autoExpand&&(this.autoExpand=a.autoExpand);"undefined"!=typeof a.ref&&(this.ref=a.ref);"undefined"!=typeof a.mCheck&&(this.multiCheck=a.mCheck);
g.isNull(a.mAutoLeafCheck)||(this.multiCheckAutoLeaf=a.mAutoLeafCheck);"undefined"!=typeof a.titleKey&&(this.titleKey=a.titleKey);"undefined"!=typeof a.key&&(this.key=a.key);"undefined"!=typeof a.subNodeKey&&(this.subNodeKey=a.subNodeKey);"undefined"!=typeof a.rootString&&(this.rootString=a.rootString);"undefined"!=typeof a.onSelect&&(this.onSelect=a.onSelect);"undefined"!=typeof a.onCheck&&(this.onCheck=a.onCheck);"undefined"!=typeof a.onDblClick&&(this.onDblClick=a.onDblClick);"undefined"!=typeof a.editable&&
(this.editable=a.editable);"undefined"!=typeof a.separate&&(this.separate=a.separate);"undefined"!=typeof a.treeIcon&&(this.treeIcon=a.treeIcon);"undefined"!=typeof a.selectTreeIcon&&(this.selectTreeIcon=a.selectTreeIcon);"undefined"!=typeof a.showRootDepth&&(this.showRootDepth=a.showRootDepth);"undefined"!=typeof a.css&&(this.css=a.css)},makeTreeView:function(){this.rootString&&(this.nodeArr[this.nodeArrLen++]="<ul class='root'>",this.nodeArr[this.nodeArrLen++]='<li id="root">',this.showRootDepth&&
(this.nodeArr[this.nodeArrLen++]="<button type='button' class='minus-top'></button>"),this.multiCheck?this.nodeArr[this.nodeArrLen++]="<input type='checkbox' />":this.nodeArr[this.nodeArrLen++]="<input type='checkbox' style='display:none;'/>",this.treeIcon.root&&""!=this.treeIcon.root?this.nodeArr[this.nodeArrLen++]='<img src="'+this.treeIcon.root+'"></input>':this.nodeArr[this.nodeArrLen++]="<img class='root' style='display:none'></span>",this.nodeArr[this.nodeArrLen++]="<span id='viewtitle' node='root'>"+
this.rootString+"</span>",this.nodeArr[this.nodeArrLen++]="<ul></ul></li></ul>",jQuery("#"+this.divID).append(this.nodeArr.join("")),delete this.nodeArr,this.nodeArr=[],this.nodeArrLen=0)},treeEvt:function(){var a=this;if(this.ref)for(var b=0;b<this.ref.length;b++){var c=this.ref[b].split("@");this.setRef(this.ref[b]);g.subscribe("binder."+c[0]+"."+c[1],function(b){a.addDumpData(b)})}jQuery("#"+this.divID).on("click","button[type=button]",function(b){var c=this.className;if(-1!=c.indexOf("plus")){for(var d=
this.parentNode.childNodes.length,f=0;f<d;f++){var h=this.parentNode.childNodes[f];if("UL"==h.tagName&&"none"==h.style.display){jQuery(h).slideDown();break}}jQuery(this.parentNode.parentNode).find("button").not(this).length&&(this.className=c=g.replace(c,"plus","minus"),c=jQuery(" > img",this.parentNode),c.attr("src")&&c.attr("click")&&c.attr("src",c.attr("click")))}else if(-1!=c.indexOf("minus")){d=this.parentNode.childNodes.length;for(f=0;f<d;f++)if(h=this.parentNode.childNodes[f],"UL"==h.tagName&&
("block"==h.style.display||""==h.style.display)){jQuery(h).slideUp();break}jQuery(this.parentNode.parentNode).find("button").not(this).length&&(this.className=c=g.replace(c,"minus","plus"),c=jQuery(" > img",this.parentNode),c.attr("src")&&c.attr("base")&&c.attr("src",c.attr("base")))}c=this.parentNode.id;a.expandedIndex.key=c;d=!1;""==a.subNodeKey&&(d=!0,a.subNodeKey="child");a.expandedIndex.data=(new Function("return "+JSON.stringify(a.findNode(c,a.DumpData))))();d&&(a.subNodeKey="");if(a.onExpand)if("function"==
typeof a.onExpand)a.onExpand(a,b);else eval(a.onExpand+"("+a+","+b+")");return!0}).on("click","span[id=viewtitle]",function(b){a.autoExpand&&jQuery(" > button[type=button]",this.parentNode).trigger("click");var c=this.parentNode.id;a.selectedIndex.key=c;var d=!1;""==a.subNodeKey&&(d=!0,a.subNodeKey="child");a.selectedIndex.data=(new Function("return "+JSON.stringify(a.findNode(c,a.DumpData))))();d&&(a.subNodeKey="");"leaf"==jQuery(this).attr("node")&&a.css&&(""!=a.preSelKey&&jQuery("> span#viewtitle",
"li#"+a.preSelKey).css(a.css.unclick),jQuery(this).css(a.css.click),a.preSelKey=jQuery(this).parent().attr("id"));if(a.onSelect)if("function"==typeof a.onSelect)a.onSelect(a,b);else eval(a.onSelect+"("+a+","+b+")");return!0}).on("dblclick","span[id=viewtitle]",function(b){a.editable&&(this.setAttribute("contenteditable",!0),this.focus());var c=this.parentNode.id;a.selectedIndex.key=c;var d=!1;""==a.subNodeKey&&(d=!0,a.subNodeKey="child");a.selectedIndex.data=(new Function("return "+JSON.stringify(a.findNode(c,
a.DumpData))))();d&&(a.subNodeKey="");if(a.onDblClick)if("function"==typeof a.onDblClick)a.onDblClick(a,b);else eval(a.onDblClick+"("+a+","+b+")");return!0}).on("blur","span[id=viewtitle]",function(b){if(this.getAttribute("contenteditable")){b=!1;""==a.subNodeKey&&(b=!0,a.subNodeKey="child");var c=a.findNode(this.parentNode.id,a.DumpData);b&&(a.subNodeKey="");c[a.titleKey]=this.innerHTML;this.setAttribute("contenteditable",!1)}}).on("keyup","span[id=viewtitle]",function(a){}).on("keypress","span[id=viewtitle]",
function(a){}).on("keydown","span[id=viewtitle]",function(a){}).on("change","span[id=viewtitle]",function(a){}).on("click","input[type=checkbox]",function(b){var c=jQuery(this).get(0).checked;jQuery(this).attr("checked",c).get(0).checked=c;a.multiCheckAutoLeaf&&jQuery(this.parentNode).find("input").not(this).each(function(){jQuery(this).attr("checked",c).get(0).checked=c});a.selectedIndex.key=this.parentNode.id;a.selectedIndex.data=b.target.checked;if(a.onCheck)if("function"==typeof a.onCheck)a.onCheck(a,
b);else eval(a.onCheck+"("+a+","+b+")")})},addDumpData:function(a){0!=this.DumpData.length&&(delete this.DumpData,this.DumpData=[]);"object"!=typeof a&&(a=(new Function("return "+a))());this.DumpData=a;delete a;this.convertData();this.makeTreeNode("",this.DumpData);this.drawTreeView("root")},addTreeViewData:function(a,b){null!=b&&""!=b&&void 0!=b&&(this.subAddTreeViewData(a,g.merge(b)),this.bMakeSubKey&&(this.subNodeKey=""))},subAddTreeViewData:function(a,b){if(""==this.subNodeKey){for(var c=[],d=
0;d<b.length;d++)if(null!=b[d]){var e=b[d][this.key],g=e.split(this.separate);curDepth=g.length-1;e=1<g.length?e.substr(0,e.lastIndexOf("-")):"";if(""==e)c.push(b[d]);else if(0==c.length)c.push(b[d]);else{for(var g=null,f=0;f<curDepth;f++)0==f?g=c[c.length-1]:g.child&&(g=g.child[g.child.length-1]);a!=e?g.child?g.child.push(b[d]):g.child=[b[d]]:g.child.push(b[d])}}this.subNodeKey="child";this.bMakeSubKey=!0;this.subAddTreeViewData("",c)}else return(""==a&&""==this.rootString?this.putData("",b):""==
a&&""!=this.rootString?this.putData("root",b):"root"==a&&""!=this.rootString?this.putData("root",b):this.putData(a,b))?(this.makeTreeNode(a,b),this.drawTreeView(a),!0):!1},putData:function(a,b){if(""==a||"root"==a)if(jQuery.isArray(b))for(var c=this.DumpData.length,d=0;d<b.length;d++)this.DumpData[c+d]={},this.DumpData[c+d]=b[d];else this.DumpData[this.DumpData.length]=b;else this.DumpData=this.putNode(a,this.DumpData,b);return!0},putNode:function(a,b,c){for(var d=0;d<b.length;d++)if(null!=b[d])if(b[d][this.key]==
a){if(b[d][this.subNodeKey]){a=b[d][this.subNodeKey].length;for(var e=0;e<c.length;e++)null!=b[d][this.subNodeKey]&&(b[d][this.subNodeKey][e+a]={},b[d][this.subNodeKey][e+a]=c[e])}else b[d][this.subNodeKey]=[],b[d][this.subNodeKey]=c;break}else b[d][this.subNodeKey]&&(b[d][this.subNodeKey]=this.putNode(a,b[d][this.subNodeKey],c));return b},putNodeNoDepth:function(a,b,c){},findNode:function(a,b){var c,d=!1;""==this.subNodeKey&&(this.subNodeKey="child",d=!0);if("root"==a)return this.DumpData;for(var e=
0;e<b.length;e++)if(null!=b[e]){if(b[e][this.key]==a)return b[e];if(b[e][this.subNodeKey]&&(c=this.findNode(a,b[e][this.subNodeKey]),null!=c))return c}d&&(this.subNodeKey="");return null},findNodeNoDepth:function(a,b){},drawTreeView:function(a){if(""==a&&""==this.rootString)jQuery("#"+this.divID).append(this.nodeArr.join(""));else if(""==a&&""!=this.rootString)jQuery("#"+this.divID+" #root > ul").append(this.nodeArr.join(""));else{"root"==a&&("msie"==g.agent.browser?document.getElementById(this.divID).childNodes[0].childNodes[0].lastChild.lastChild&&
"last"==document.getElementById(this.divID).childNodes[0].childNodes[0].lastChild.lastChild.className&&(document.getElementById(this.divID).childNodes[0].childNodes[0].lastChild.lastChild.className=""):jQuery("#"+this.divID+" #"+a+" > ul > li").get(0)&&jQuery("#"+this.divID+" #"+a+" > ul > li:last-Child").hasClass("last")&&jQuery("#"+this.divID+" #"+a+" > ul > li:last-Child").removeClass("last"));if(jQuery("#"+this.divID+" #"+a+" > button").hasClass("plus")){if(0==this.nodeArr.length)if(0==jQuery("#"+
this.divID+" #"+a).children("ul").children("li").length)"root"!=a&&(jQuery("#"+this.divID+" #"+a+" > button").removeClass("plus"),jQuery("#"+this.divID+" #"+a).children("ul").css("display","none"),jQuery("#"+this.divID+" #"+a+" > span").attr("node","leaf"),this.treeIcon&&this.treeIcon.leaf&&jQuery("#"+this.divID+" #"+a+" > img").attr("src",this.treeIcon.leaf));else{var b=jQuery("#"+this.divID+" #"+a).children("ul").children("li").length;if(jQuery(jQuery("#"+this.divID+" #"+a).children("ul").children("li")[b-
1]).children("button")[0]){var c=jQuery(jQuery("#"+this.divID+" #"+a).children("ul").children("li")[b-1]).children("button")[0].className;jQuery("#"+this.divID+" #"+a).children("ul").children("li")[b-1].className="last";switch(c){case "plus":jQuery(jQuery("#"+this.divID+" #"+a).children("ul").children("li")[b-1]).children("button")[0].className="plus-bottom";break;case "minus":jQuery(jQuery("#"+this.divID+" #"+a).children("ul").children("li")[b-1]).children("button")[0].className="minus-bottom";break;
case "":jQuery(jQuery("#"+this.divID+" #"+a).children("ul").children("li")[b-1]).children("button")[0].className="last"}}}}else if(jQuery("#"+this.divID+" #"+a+" > button").hasClass("minus"))if(0==this.nodeArr.length)if(0==jQuery("#"+this.divID+" #"+a).children("ul").children("li").length)"root"!=a&&(jQuery("#"+this.divID+" #"+a).children("ul").css("display","none"),jQuery("#"+this.divID+" #"+a+" > button").removeClass("minus"),jQuery("#"+this.divID+" #"+a+" > span").attr("node","leaf"),this.treeIcon&&
this.treeIcon.leaf&&jQuery("#"+this.divID+" #"+a+" > img").attr("src",this.treeIcon.leaf));else{if(b=jQuery("#"+this.divID+" #"+a).children("ul").children("li").length,jQuery(jQuery("#"+this.divID+" #"+a).children("ul").children("li")[b-1]).children("button")[0])switch(c=jQuery(jQuery("#"+this.divID+" #"+a).children("ul").children("li")[b-1]).children("button")[0].className,jQuery("#"+this.divID+" #"+a).children("ul").children("li")[b-1].className="last",c){case "plus":jQuery(jQuery("#"+this.divID+
" #"+a).children("ul").children("li")[b-1]).children("button")[0].className="plus-bottom";break;case "minus":jQuery(jQuery("#"+this.divID+" #"+a).children("ul").children("li")[b-1]).children("button")[0].className="minus-bottom";break;case "":jQuery(jQuery("#"+this.divID+" #"+a).children("ul").children("li")[b-1]).children("button")[0].className="last"}}else jQuery("#"+this.divID+" #"+a).children("ul").css("display","none"),jQuery("#"+this.divID+" #"+a+" > button").removeClass("minus"),jQuery("#"+
this.divID+" #"+a+" > button").addClass("plus");else if(jQuery("#"+this.divID+" #"+a+" > button").hasClass("plus-bottom")){if(0==this.nodeArr.length&&0==jQuery("#"+this.divID+" #"+a).children("ul").children("li").length)if("root"!=a)jQuery("#"+this.divID+" #"+a+" > button").removeClass("plus-bottom"),jQuery("#"+this.divID+" #"+a+" > span").attr("node","leaf"),this.treeIcon&&this.treeIcon.leaf&&jQuery("#"+this.divID+" #"+a+" > img").attr("src",this.treeIcon.leaf);else if(b=jQuery("#"+this.divID+" #"+
a).children("ul").children("li").length,jQuery(jQuery("#"+this.divID+" #"+a).children("ul").children("li")[b-1]).children("button")[0])switch(c=jQuery(jQuery("#"+this.divID+" #"+a).children("ul").children("li")[b-1]).children("button")[0].className,jQuery("#"+this.divID+" #"+a).children("ul").children("li")[b-1].className="last",c){case "plus":jQuery(jQuery("#"+this.divID+" #"+a).children("ul").children("li")[b-1]).children("button")[0].className="plus-bottom";break;case "minus":jQuery(jQuery("#"+
this.divID+" #"+a).children("ul").children("li")[b-1]).children("button")[0].className="minus-bottom";break;case "":jQuery(jQuery("#"+this.divID+" #"+a).children("ul").children("li")[b-1]).children("button")[0].className="last"}}else if(jQuery("#"+this.divID+" #"+a+" > button").hasClass("minus-bottom"))if(0==this.nodeArr.length)if(0==jQuery("#"+this.divID+" #"+a).children("ul").children("li").length)"root"!=a&&(jQuery("#"+this.divID+" #"+a+" > button").removeClass("minus-bottom"),jQuery("#"+this.divID+
" #"+a+" > span").attr("node","leaf"),this.treeIcon&&this.treeIcon.leaf&&jQuery("#"+this.divID+" #"+a+" > img").attr("src",this.treeIcon.leaf));else{if(b=jQuery("#"+this.divID+" #"+a).children("ul").children("li").length,jQuery(jQuery("#"+this.divID+" #"+a).children("ul").children("li")[b-1]).children("button")[0])switch(c=jQuery(jQuery("#"+this.divID+" #"+a).children("ul").children("li")[b-1]).children("button")[0].className,jQuery("#"+this.divID+" #"+a).children("ul").children("li")[b-1].className=
"last",c){case "plus":jQuery(jQuery("#"+this.divID+" #"+a).children("ul").children("li")[b-1]).children("button")[0].className="plus-bottom";break;case "minus":jQuery(jQuery("#"+this.divID+" #"+a).children("ul").children("li")[b-1]).children("button")[0].className="minus-bottom";break;case "":jQuery(jQuery("#"+this.divID+" #"+a).children("ul").children("li")[b-1]).children("button")[0].className="last"}}else jQuery("#"+this.divID+" #"+a).children("ul").css("display","none"),jQuery("#"+this.divID+
" #"+a+" > button").addClass("plus");else if(jQuery("#"+this.divID+" #"+a).hasClass("last"))jQuery("#"+this.divID+" #"+a+" > button").addClass("plus-bottom"),jQuery("#"+this.divID+" #"+a+" > span").attr("node","parent"),this.treeIcon&&this.treeIcon.parent&&jQuery("#"+this.divID+" #"+a+" > img").attr("src",this.treeIcon.parent);else if("root"!=a&&(jQuery("#"+this.divID+" #"+a+" > button").addClass("plus"),jQuery("#"+this.divID+" #"+a+" > span").attr("node","parent"),this.treeIcon&&this.treeIcon.parent&&
jQuery("#"+this.divID+" #"+a+" > img").attr("src",this.treeIcon.parent)),0==this.nodeArr.length&&(b=jQuery("#"+this.divID+" #"+a).children("ul").children("li").length,jQuery(jQuery("#"+this.divID+" #"+a).children("ul").children("li")[b-1]).children("button")[0]))switch(c=jQuery(jQuery("#"+this.divID+" #"+a).children("ul").children("li")[b-1]).children("button")[0].className,jQuery("#"+this.divID+" #"+a).children("ul").children("li")[b-1].className="last",c){case "plus":jQuery(jQuery("#"+this.divID+
" #"+a).children("ul").children("li")[b-1]).children("button")[0].className="plus-bottom";break;case "minus":jQuery(jQuery("#"+this.divID+" #"+a).children("ul").children("li")[b-1]).children("button")[0].className="minus-bottom";break;case "":jQuery(jQuery("#"+this.divID+" #"+a).children("ul").children("li")[b-1]).children("button")[0].className="last"}jQuery("#"+this.divID+" #"+a+" > ul").append(this.nodeArr.join(""))}delete this.nodeArr;this.nodeArr=[];this.nodeArrLen=0},makeTreeNode:function(a,
b){for(var c=0;c<b.length;c++)if(null!=b[c]){var d=b[c][this.key];c+1==b.length?g.isNull(b[c][this.subNodeKey])?(this.nodeArr[this.nodeArrLen++]='<li id="'+d+"\" class='last'>",this.nodeArr[this.nodeArrLen++]="<button type='button' ></button>",this.multiCheck?this.nodeArr[this.nodeArrLen++]="<input type='checkbox' />":this.nodeArr[this.nodeArrLen++]="<input type='checkbox' style='display:none;'/>",this.treeIcon.parent&&!g.isNull(this.treeIcon.parent)?this.nodeArr[this.nodeArrLen++]='<img src="'+this.treeIcon.leaf+
'"></input>':this.treeIcon.leaf&&!g.isNull(this.treeIcon.leaf)?this.nodeArr[this.nodeArrLen++]='<img src="'+this.treeIcon.leaf+'"></input>':this.nodeArr[this.nodeArrLen++]="<img class='leaf' style='display:none;'></input>",this.nodeArr[this.nodeArrLen++]="<span id='viewtitle'node='leaf'>"+b[c][this.titleKey]+"</span>",this.nodeArr[this.nodeArrLen++]="<ul style='display:none;'></ul></li>"):(this.nodeArr[this.nodeArrLen++]='<li id="'+d+"\" class='last'>",this.nodeArr[this.nodeArrLen++]="<button type='button' class='plus-bottom'></button>",
this.multiCheck?this.nodeArr[this.nodeArrLen++]="<input type='checkbox' />":this.nodeArr[this.nodeArrLen++]="<input type='checkbox' style='display:none;'/>",this.treeIcon.parent&&!g.isNull(this.treeIcon.parent)?this.nodeArr[this.nodeArrLen++]='<img src="'+this.treeIcon.parent+'"></input>':this.nodeArr[this.nodeArrLen++]="<img class='parent' style='display:none;'></input>",this.nodeArr[this.nodeArrLen++]="<span id='viewtitle' node='parent'>"+b[c][this.titleKey]+"</span>",this.nodeArr[this.nodeArrLen++]=
"<ul style='display:none;'>",this.makeTreeNode(d,b[c][this.subNodeKey]),this.nodeArr[this.nodeArrLen++]="</ul></li>"):g.isNull(b[c][this.subNodeKey])?(this.nodeArr[this.nodeArrLen++]='<li id="'+d+'">',this.nodeArr[this.nodeArrLen++]="<button type='button' ></button>",this.multiCheck?this.nodeArr[this.nodeArrLen++]="<input type='checkbox' />":this.nodeArr[this.nodeArrLen++]="<input type='checkbox' style='display:none;'/>",this.treeIcon.leaf&&!g.isNull(this.treeIcon.leaf)?this.nodeArr[this.nodeArrLen++]=
'<img src="'+this.treeIcon.leaf+'"></input>':this.nodeArr[this.nodeArrLen++]="<img class='leaf' style='display:none;'></input>",this.nodeArr[this.nodeArrLen++]="<span id='viewtitle'node='leaf'>"+b[c][this.titleKey]+"</span>",this.nodeArr[this.nodeArrLen++]="<ul style='display:none;'></ul></li>"):(this.nodeArr[this.nodeArrLen++]='<li id="'+d+'">',this.nodeArr[this.nodeArrLen++]="<button type='button' class='plus'></button>",this.multiCheck?this.nodeArr[this.nodeArrLen++]="<input type='checkbox' />":
this.nodeArr[this.nodeArrLen++]="<input type='checkbox' style='display:none;'/>",this.treeIcon.parent&&!g.isNull(this.treeIcon.parent)?this.nodeArr[this.nodeArrLen++]='<img src="'+this.treeIcon.parent+'"></input>':this.nodeArr[this.nodeArrLen++]="<img class='parent' style='display:none;'></input>",this.nodeArr[this.nodeArrLen++]="<span id='viewtitle' node='parent'>"+b[c][this.titleKey]+"</span>",this.nodeArr[this.nodeArrLen++]="<ul style='display:none;'>",this.makeTreeNode(d,b[c][this.subNodeKey]),
this.nodeArr[this.nodeArrLen++]="</ul>",this.nodeArr[this.nodeArrLen++]="</li>")}},convertData:function(){for(var a=[],b=0;b<this.DumpData.length;b++)-1==this.DumpData[b][this.key].indexOf(this.separate)&&(a.push(this.DumpData.splice(b,1)[0]),b--);for(b=0;b<a.length;b++)a[b].child=this.convertSubData(a[b][this.key])},convertSubData:function(a){for(var b=[],c="",d=0;d<this.DumpData.length;d++){var e=this.DumpData[d][this.key];if(0==e.indexOf(a)&&e.split(this.separate).length==a.split(this.separate).length+
1)b[b.length]=this.DumpData.splice(d,1)[0],d--;else if(-1==e.indexOf(a))break;else e.split(this.separate).length==c.split(this.separate).length+1&&(b.child=this.convertSubData(c));c=e}return b},makeTreeNodeNoDepth:function(a,b){for(var c=b.length,d=0;d<c;d++)var e=b[d][this.key];d+1<c&&this.DumpData[d+1].dt[this.key].indexOf(e);""==a||"root"==a?this.nodeArr[this.nodeArrLen++]='<ul style="display:block" id="'+e+'">':this.nodeArr[this.nodeArrLen++]='<ul style="display:none" id="'+e+'">'},changeTreeIcon:function(a,
b){""!=a&&(jQuery("li#"+a+" > img").attr("src",b.base).show(),b.click&&(jQuery("li#"+a+" > span").attr("node","parent"),jQuery("li#"+a+" > img").attr("base",b.base).attr("click",b.click)))},getTreeviewData:function(a){a=this.findNode(a,this.DumpData);return(new Function("return "+JSON.stringify(a)))()},deleteTreeviewData:function(a){var b=jQuery("#"+this.divID+" #"+a).parent().parent().attr("id");this.deleteNode(a,this.DumpData);("undefined"!=typeof b||b)&&this.drawTreeView(b)},removeAll:function(){if(0<
jQuery("#"+this.divID+" #root").length)for(var a=jQuery("#"+this.divID+" #root").children("ul")[0].childNodes.length,b=0;b<a;b++)jQuery("#"+this.divID+" #root").children("ul")[0].removeChild(jQuery("#"+this.divID+" #root").children("ul")[0].childNodes[0]);else for(a=document.getElementById(this.divID).childNodes.length,b=0;b<a;b++)document.getElementById(this.divID).removeChild(document.getElementById(this.divID).childNodes[0]);this.bMakeSubKey&&(this.bMakeSubKey=!1,this.subNodeKey="");this.DumpData=
[]},deleteNode:function(a,b){for(var c=b.length,d=0;d<c;d++)if(null!=b[d]){if(b[d][this.key]==a)return b.splice(d,1),jQuery("#"+this.divID+" #"+a).remove(),!0;b[d][this.subNodeKey]&&this.deleteNode(a,b[d][this.subNodeKey])}return!1},getCheckNodeKey:function(){if(!this.multiCheck)return null;var a=[],b=!0;this.subNodeKey||(b=!1,this.subNodeKey="child");for(var c=0;c<this.DumpData.length;c++)if(null!=this.DumpData[c]){var d=this.DumpData[c][this.key];jQuery("#"+this.divID+" #"+d+">input[type=checkbox]").attr("checked")&&
(a[a.length]=d);this.DumpData[c][this.subNodeKey]&&(a=g.merge(a,this.getChildCheckNodeKey(this.DumpData[c][this.subNodeKey])))}b||(this.subNodeKey="");return a},getChildCheckNodeKey:function(a){for(var b=[],c=0;c<a.length;c++)if(null!=a[c]){var d=a[c][this.key];jQuery("#"+this.divID+" #"+d+">input[type=checkbox]").attr("checked")&&(b[b.length]=d);a[c][this.subNodeKey]&&(b=g.merge(b,this.getChildCheckNodeKey(a[c][this.subNodeKey])))}return b},expandNode:function(a,b){var c=!1;arguments[1]&&(c=arguments[1]);
var d;0==arguments.length?(d="root",c=!0):d=a;if(this.subNodeKey){for(var e=[],k=this.DumpData.length,f=0;f<k;f++){if(d==this.DumpData[f][this.key]){e[e.length]=this.DumpData[f][this.key];break}else if(this.DumpData[f][this.subNodeKey]){var h=this.findNodeKey(this.DumpData[f][this.subNodeKey],d);if(0<h.length){e[e.length]=this.DumpData[f][this.key];e=g.merge(e,h);break}}e=[]}"root"==d&&(e[0]="root");if(0<e.length){for(f=0;f<e.length-1;f++)(h=jQuery("#"+this.divID+" #"+e[f]))&&"none"==jQuery("#"+this.divID+
" #"+e[f]+">ul").css("display")&&jQuery("#"+this.divID+" #"+e[f]+">button").trigger("click");if(c)for(c=jQuery("#"+this.divID+" #"+e[f]+" ul li"),f=0;f<c.length;f++)"none"==jQuery(c[f]).find(">ul").css("display")&&jQuery(c[f].firstChild).trigger("click")}}else{for(var e=d.split(this.separate),k=e[0],f=0;f<e.length;f++)0<f&&(k+=this.separate,k+=e[f]),(h=jQuery("#"+this.divID+" #"+k))&&"none"==jQuery("#"+this.divID+" #"+k+">ul").css("display")&&jQuery("#"+this.divID+" #"+k+">button").trigger("click");
if(c)for(c=jQuery("#"+this.divID+" #"+d+" ul li"),f=0;f<c.length;f++)"none"==jQuery(c[f]).find(">ul").css("display")&&jQuery(c[f].firstChild).trigger("click")}},foldNode:function(a,b){var c=!0;arguments[1]&&(c=arguments[1]);var d=!0;this.subNodeKey||(d=!1,this.subNodeKey="child");0==arguments.length&&(a="root");if(jQuery("#"+this.divID+" #"+a)){if(c)for(var c=jQuery("#"+this.divID+" #"+a+" ul li"),e=0;e<c.length;e++)"none"!=jQuery(c[e]).find(">ul").css("display")&&c[e].firstChild&&jQuery(c[e].firstChild).trigger("click");
"none"!=jQuery("#"+this.divID+" #"+a+">ul").css("display")&&jQuery("#"+this.divID+" #"+a+">button").trigger("click")}d||(this.subNodeKey="")},selectionNode:function(a){if("root"==a){if(""!=this.preSelKey){var b=jQuery("#"+this.divID+" #"+this.preSelKey+"> span#viewtitle");b.css(this.css.unclick)}jQuery("#"+this.divID+" #root > span#viewtitle").css(this.css.click);this.preSelKey="root"}else if(this.subNodeKey){for(var c=[],d=this.DumpData.length,e=0;e<d;e++){if(a==this.DumpData[e][this.key]){c[c.length]=
this.DumpData[e][this.key];break}else if(this.DumpData[e][this.subNodeKey]&&(b=this.findNodeKey(this.DumpData[e][this.subNodeKey],a),0<b.length)){c[c.length]=this.DumpData[e][this.key];c=g.merge(c,b);break}c=[]}if(0<c.length){for(e=0;e<c.length-1;e++)(d=jQuery("#"+this.divID+" #"+c[e]))&&"none"==jQuery("#"+this.divID+" #"+c[e]+">ul").css("display")&&jQuery("#"+this.divID+" #"+c[e]+">button").trigger("click");""!=this.preSelKey&&(b=jQuery("#"+this.divID+" #"+this.preSelKey+"> span#viewtitle"),b.css(this.css.unclick));
jQuery("#"+this.divID+" #"+c[e]+"> span#viewtitle").css(this.css.click);this.preSelKey=c[e]}}else{for(var c=a.split(this.separate),b=c[0],e=0;e<c.length;e++)0<e&&(b+=this.separate,b+=c[e]),(d=jQuery("#"+this.divID+" #"+b))&&"none"==jQuery("#"+this.divID+" #"+b+">ul").css("display")&&jQuery("#"+this.divID+" #"+b+">button").trigger("click");""!=this.preSelKey&&(b=jQuery("#"+this.divID+" #"+this.preSelKey+"> span#viewtitle"),b.css(this.css.unclick));jQuery("#"+this.divID+" #"+a+"> span#viewtitle").css(this.css.click);
this.preSelKey=jQuery("#"+this.divID+" #"+a).attr("id")}},findNodeKey:function(a,b){for(var c=[],d=0;d<a.length;d++)if(null!=a[d]){if(b==a[d][this.key])return c[c.length]=a[d][this.key],c;if(a[d][this.subNodeKey]){var e=this.findNodeKey(a[d][this.subNodeKey],b);if(0<e.length)return c[c.length]=a[d][this.key],c=g.merge(c,e)}c=[]}return c=[]},checkExpandNode:function(a){return jQuery("#"+this.divID+" #"+a)[0]?"none"==jQuery("#"+this.divID+" #"+a+">ul").css("display")?!1:!0:!1},getRowNum:function(){var a=
0,b="child";this.subNodeKey&&(b=this.subNodeKey);for(var c=function(c){for(var d=0,e=c.length;d<e;d++)jQuery.isArray(c[d][b])&&arguments.callee(c[d][b]),a++},d=0,e=this.DumpData.length;d<e;d++)jQuery.isArray(this.DumpData[d][b])&&c(this.DumpData[d][b]),a++;this.rootString&&a++;return a}});g._addWidget("treeview",g.widget.treeview)})(naw);