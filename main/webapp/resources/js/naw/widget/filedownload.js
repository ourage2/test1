(function(c){c.namespace("widget.filedownload");if(!f)var f={};f.create=c.getMessage("W0201");f.initialize=c.getMessage("W0202");f.check1=c.getMessage("W0203");f.result1=c.getMessage("W0204");var g;c.widget.filedownload=c.widget.Base.extend({init:function(a,d){this.setName("filedownload");this._super();this.info=this._getTemplate(a);this.info.renderTo=d.id;var b=this._getTemplate(a);this.callBackFunction=b.callBackFunction?b.callBackFunction:null;this.uploadId=b.nodeId?b.nodeId:null;this.drm="undefined"!=
typeof b.drm?b.drm:c.config.drmOptions.download;this._create()},_create:function(){var a=this;c.subscribe("theme.change",function(b){a.changeTheme(b.themeName,b.themeBasePath)});var d=this.info.renderTo;g=this.callBackFunction;var b;b=""+('<input type="text" id="'+d+'_filename"/>&nbsp');if(naw.config.crossDomain&&naw.config.crossDomain.apply){var e=naw._getFixedUri(naw.config.crossDomain.blank);b+='<iframe id="'+d+'_iframe" name="'+d+'_iframe" src="'+e+'" style="display:none"/>&nbsp'}else b+='<iframe id="'+
d+'_iframe" name="'+d+'_iframe" style="display:none"/>&nbsp';b+='<input type="button" id="'+d+'_down" value="파일다운"/>';jQuery("#"+d).html(b);jQuery("#"+d+"_iframe").on("load",function(){try{var a=jQuery(this.contentDocument.body)}catch(p){if(naw.config.crossDomain&&naw.config.crossDomain.apply){naw.showSlideMessage("파일 다운로드에 실패하였습니다.");return}}var b=a.text();""!=b&&(naw.behavior.IDownloadStatus?naw.behavior.IDownloadStatus(b):(b=b.split("|"),naw.showSlideMessage(1==b.length?b[0]:b[1])),a.text(""))});
jQuery.download=function(b,a,c){if("msie"==naw.agent.browser&&10>parseInt(naw.agent.version)){if(b&&a){a="string"==typeof a?a:jQuery.param(a);var e="";jQuery.each(a.split("&"),function(){var a=this.split("=");e+='<input type="hidden" name="'+a[0]+'" value="'+a[1].replace(/%26/g,"&")+'" />'});jQuery('<form action="'+b+'" method="'+(c||"post")+'" target="'+d+'_iframe">'+e+"</form>").appendTo("body").submit().remove()}}else jQuery.ajaxTransport("+binary",function(a,b,d){if(window.FormData&&(a.dataType&&
"binary"==a.dataType||a.data&&(window.ArrayBuffer&&a.data instanceof ArrayBuffer||window.Blob&&a.data instanceof Blob)))return{send:function(b,d){var c=new XMLHttpRequest,e=a.url,m=a.type,f=a.async||!0,n=a.responseType||"blob",g=a.data||null,h=a.username||null,l=a.password||null;c.addEventListener("load",function(){var b={};b[a.dataType]=c.response;d(c.status,c.statusText,b,c.getAllResponseHeaders())});c.open(m,e,f,h,l);for(var k in b)c.setRequestHeader(k,b[k]);c.responseType=n;c.send(g)},abort:function(){}}}),
jQuery.ajax({type:"POST",url:b,data:a,dataType:"binary",success:function(b,c,e){c=a.orgFNameExt;e.getResponseHeader("Content-Type");if("undefined"!==typeof window.navigator.msSaveBlob)window.navigator.msSaveBlob(b,c);else{var f=window.URL||window.webkitURL,h=f.createObjectURL(b);c?(b=document.createElement("a"),"undefined"===typeof b.download?window.location=h:(b.href=h,b.download=c,document.body.appendChild(b),b.id=d+"_down",b.click())):window.location=h;setTimeout(function(){f.revokeObjectURL(h)},
100)}g&&g.call("",[a])},error:function(a,b,c){alert("다운로드 실패. Error Message : "+b)}})}},filedownSubmit:function(a,d,b,e){"undefined"==typeof a?c.showSlideMessage(f.check1):this._filedownStream(a,d,b,e)},_filedownStream:function(a,d,b,e){if("msie"==naw.agent.browser&&10>parseInt(naw.agent.version))a="funCd=down&saveFName="+a+("&orgFName="+d.replace(/&/g,"%26")),a+="&subFPath="+b,a="undefined"!=typeof e?a+("&drm="+e):a+("&drm="+this.drm);else{e="undefined"!=typeof e?e:this.drm;var f=d.split(".");a=
{funCd:"down",orgFNameExt:d.replace(/&/g,"%26"),orgFName:f[0],saveFName:a,fExt:f[1],subFPath:b,drm:e}}b=c._getServletUri?c._getServletUri("upload"):c._getFixedUri(c.config.servletURI.upload);naw.config.crossDomain&&naw.config.crossDomain.apply?jQuery.download(b+"?upload_id="+this.uploadId+"&iscross=Y",a,"POST"):jQuery.download(b+"?upload_id="+this.uploadId,a,"POST")},getServerFilePath:function(a,d,b){var e=c._getServletUri("upload")+"?upload_id="+this.uploadId+"&funCd=down";return e=e+("&subFPath="+
("undefined"==typeof b?"":b))+("&saveFName="+("undefined"==typeof a?"":a))+("&orgFName="+("undefined"==typeof d?"":d))},changeNodeId:function(a){this.uploadId=a?a:null},changeCallFunc:function(a){g=a?a:null}});c._addWidget("filedownload",naw.widget.filedownload)})(naw);