(function(f,m){f.namespace("widget.gauge");f.gauge={conf:{renderTo:null,width:200,height:200,shape:"circle",title:!1,maxValue:100,minValue:0,majorTicks:[],minorTicks:10,strokeTicks:!0,units:!1,valueFormat:{"int":3,dec:2},majorTicksFormat:{"int":1,dec:0},glow:!0,animation:{delay:10,duration:250,fn:"cycle"},colors:{plate:"#fff",majorTicks:"#444",minorTicks:"#666",title:"#888",units:"#888",numbers:"#444",needle:{start:"rgba(240, 128, 128, 1)",end:"rgba(255, 160, 122, .9)"}},highlights:[{from:20,to:60,
color:"#eee"},{from:60,to:80,color:"#ccc"},{from:80,to:100,color:"#999"}]}};var g=0,k=0;f.widget.gauge=f.widget.Base.extend({init:function(a,c){this.setName("gauge");this._super();this.conf=jQuery.extend({},f.gauge.conf,this._getTemplate(a));this.conf.renderTo=c.id;this.root=a;this.value=0;this.self=this;this.initialized=this.imready=!1;this.animateInterval=null;this.cache;this.CW;this.CH;this.CX;this.CY;this.max;this.id=this.conf.renderTo;if(!this.id)throw Error("Canvas element was not specified when creating the Gauge object!");
"msie"==f.agent.browser&&"6.0"==f.agent.version||"7.0"==f.agent.version||"8.0"==f.agent.version?alert("Gauge Widget은 Internet Explorer 9.0 이상을 지원합니다."):this.create()},create:function(){this.canvas=this.conf.renderTo.tagName?this.conf.renderTo:document.getElementById(this.conf.renderTo);this.ctx=this.canvas.getContext("2d");this.cctx;this.baseInit();this.ctx.lineCap="circle";this.initialized=!0;this.value=g=k=this.conf.minValue;this.draw()},setValue:function(a){g=this.conf.animation?this.value:a;var c=
(this.conf.maxValue-this.conf.minValue)/100;k=a>this.conf.maxValue?this.conf.maxValue+c:a<this.conf.minValue?this.conf.minValue-c:a;this.value=a;this.conf.animation?this.animate():this.draw();(this.getValue()<this.conf.minValue||this.getValue()>this.conf.maxValue)&&f.messagebox({height:100,width:300,title:"Gauge 유효성 체크",message:"<b>"+this.conf.title+"</b>의 데이터값이 지정된 범위를 벗어났습니다.",dialogType:"alert",align:"left",autoCloseMsgBox:!0,autoCloseTime:1});return this},setRawValue:function(a){g=this.value=
a;this.draw();return this},clear:function(){this.value=g=k=this.conf.minValue;this.draw();return this},getValue:function(){return this.value},applyRecursive:function(a,c){for(var b in c)"object"==typeof c[b]&&"[object Array]"!==Object.prototype.toString.call(c[b])&&"renderTo"!=b?("object"!=typeof a[b]&&(a[b]={}),this.applyRecursive(a[b],c[b])):a[b]=c[b]},baseInit:function(){this.canvas.width=this.conf.width;this.canvas.height=this.conf.height;this.cache=this.canvas.cloneNode(!0);this.cctx=this.cache.getContext("2d");
this.CW=this.canvas.width;this.CH=this.canvas.height;this.CX=this.CW/2;this.CY=this.CH/2;this.max=this.CX<this.CY?this.CX:this.CY;this.cache.i8d=!1;this.cctx.translate(this.CX,this.CY);this.cctx.save();this.ctx.translate(this.CX,this.CY);this.ctx.save()},updateConfig:function(a){this.conf=jQuery.extend({},f.gauge.conf,a);this.baseInit();this.draw();return this},_animate:function(a,c){var b=new Date,d={linear:function(a){return a},quad:function(a){return Math.pow(a,2)},quint:function(a){return Math.pow(a,
5)},cycle:function(a){return 1-Math.sin(Math.acos(a))},bounce:function(a){a:{a=1-a;for(var b=0,c=1;;b+=c,c/=2)if(a>=(7-4*b)/11){a=-Math.pow((11-6*b-11*a)/4,2)+Math.pow(c,2);break a}}return 1-a},elastic:function(a){a=1-a;return 1-Math.pow(2,10*(a-1))*Math.cos(30*Math.PI/3*a)}},e=setInterval(function(){var h=(new Date-b)/a.duration;1<h&&(h=1);var f=("function"==typeof a.delta?a.delta:d[a.delta])(h);a.step(f);c.draw();1==h&&clearInterval(e)},a.delay||10)},animate:function(){this.animateInterval&&clearInterval(this.animateInterval);
var a=k-g,c=g,b=this.conf.animation;this._animate({delay:b.delay,duration:b.duration,delta:b.fn,step:function(b){g=parseFloat(c)+a*b}},this.self)},draw:function(){if(("msie"!=f.agent.browser||"6.0"!=f.agent.version)&&"7.0"!=f.agent.version&&"8.0"!=f.agent.version){if(!this.cache.i8d){this.cctx.clearRect(-this.CX,-this.CY,this.CW,this.CH);this.cctx.save();var a={ctx:this.ctx};this.ctx=this.cctx;this.drawPlate();this.drawHighlights();this.drawMinorTicks();this.drawMajorTicks();this.drawNumbers();this.drawTitle();
this.drawUnits();this.cache.i8d=!0;this.ctx=a.ctx;delete a.ctx}this.ctx.clearRect(-this.CX,-this.CY,this.CW,this.CH);this.ctx.save();this.ctx.drawImage(this.cache,-this.CX,-this.CY,this.CW,this.CH);var c=this.self;if(this.initialized)c.drawValueBox(),c.drawNeedle(),this.imready||(this.imready=!0);else var b=setInterval(function(){this.initialized&&(clearInterval(b),c.drawValueBox(),c.drawNeedle(),this.imready||(this.imready=!0))},10);return this}},radians:function(a){return a*Math.PI/180},lgrad:function(a,
c,b){b=this.ctx.createLinearGradient(0,0,0,b);b.addColorStop(0,a);b.addColorStop(1,c);return b},drawPlate:function(){var a=this.max/100*93,c=this.max-a,b=this.max/100*91,d=this.max/100*88,e=this.max/100*85;this.ctx.save();this.conf.glow&&(this.ctx.shadowBlur=c,this.ctx.shadowColor="rgba(0, 0, 0, 0.5)");this.ctx.beginPath();this.ctx.fillStyle=this.lgrad("#ddd","#aaa",a);""==this.conf.shape||"circle"==this.conf.shape?this.ctx.arc(0,0,a,0,2*Math.PI,!0):"semicircle"==this.conf.shape?(this.ctx.arc(0,0,
a,0,Math.PI,!0),this.ctx.fillRect(-a,-a/16,2*a,a/1.3)):"rectangle"==this.conf.shape&&this.ctx.fillRect(-a,-a,2*a,2*a);this.ctx.fill();this.ctx.restore();this.ctx.beginPath();this.ctx.fillStyle=this.lgrad("#fafafa","#ccc",b);""==this.conf.shape||"circle"==this.conf.shape?this.ctx.arc(0,0,b,0,2*Math.PI,!0):"semicircle"==this.conf.shape?(this.ctx.arc(0,0,b,0,Math.PI,!0),this.ctx.fillRect(-b,-b/16,2*b,b/1.3)):"rectangle"==this.conf.shape&&this.ctx.fillRect(-b,-b,2*b,2*b);this.ctx.fill();this.ctx.beginPath();
this.ctx.fillStyle=this.lgrad("#eee","#f0f0f0",d);""==this.conf.shape||"circle"==this.conf.shape?this.ctx.arc(0,0,d,0,2*Math.PI,!0):"semicircle"==this.conf.shape?(this.ctx.arc(0,0,d,0,Math.PI,!0),this.ctx.fillRect(-d,-d/16,2*d,d/1.3)):"rectangle"==this.conf.shape&&this.ctx.fillRect(-d,-d,2*d,2*d);this.ctx.fill();this.ctx.beginPath();this.ctx.fillStyle=this.conf.colors.plate;""==this.conf.shape||"circle"==this.conf.shape?this.ctx.arc(0,0,e,0,2*Math.PI,!0):"semicircle"==this.conf.shape?(this.ctx.arc(0,
0,e,0,Math.PI,!0),this.ctx.fillRect(-e,-e/16,2*e,e/1.3)):"rectangle"==this.conf.shape&&this.ctx.fillRect(-e,-e,2*e,2*e);this.ctx.fill();this.ctx.save()},drawHighlights:function(){this.ctx.save();for(var a=this.max/100*81,c=a-this.max/100*15,b=0,d=this.conf.highlights.length;b<d;b++){var e=this.conf.highlights[b];if(""==this.conf.shape||"circle"==this.conf.shape||"rectangle"==this.conf.shape)var h=(this.conf.maxValue-this.conf.minValue)/270,f=this.radians(45+(e.from-this.conf.minValue)/h),h=this.radians(45+
(e.to-this.conf.minValue)/h);else"semicircle"==this.conf.shape&&(h=(this.conf.maxValue-this.conf.minValue)/180,f=this.radians(90+(e.from-this.conf.minValue)/h),h=this.radians(90+(e.to-this.conf.minValue)/h));this.ctx.beginPath();this.ctx.rotate(this.radians(90));this.ctx.arc(0,0,a,f,h,!1);this.ctx.restore();this.ctx.save();var g=this.rpoint(c,f),l=this.rpoint(a,f);this.ctx.moveTo(g.x,g.y);this.ctx.lineTo(l.x,l.y);var l=this.rpoint(a,h),k=this.rpoint(c,h);this.ctx.lineTo(l.x,l.y);this.ctx.lineTo(k.x,
k.y);this.ctx.lineTo(g.x,g.y);this.ctx.closePath();this.ctx.fillStyle=e.color;this.ctx.fill();this.ctx.beginPath();this.ctx.rotate(this.radians(90));this.ctx.arc(0,0,c,f-.2,h+.2,!1);this.ctx.restore();this.ctx.closePath();this.ctx.fillStyle=this.conf.colors.plate;this.ctx.fill();this.ctx.save()}},drawNeedle:function(){var a=this.max/100*12,c=this.max/100*8,b=this.max/100*77,d=this.max/100*20,e=this.max/100*4,f=this.max/100*2,k=function(){this.ctx.shadowOffsetX=2;this.ctx.shadowOffsetY=2;this.ctx.shadowBlur=
10;this.ctx.shadowColor="rgba(188, 143, 143, 0.45)"};k;this.ctx.save();g=0>g?Math.abs(this.conf.minValue-g):0<this.conf.minValue?g-this.conf.minValue:Math.abs(this.conf.minValue)+g;""==this.conf.shape||"circle"==this.conf.shape||"rectangle"==this.conf.shape?this.ctx.rotate(this.radians(45+g/((this.conf.maxValue-this.conf.minValue)/270))):"semicircle"==this.conf.shape&&this.ctx.rotate(this.radians(90+g/((this.conf.maxValue-this.conf.minValue)/180)));this.ctx.beginPath();this.ctx.moveTo(-f,-d);this.ctx.lineTo(-e,
0);this.ctx.lineTo(-1,b);this.ctx.lineTo(1,b);this.ctx.lineTo(e,0);this.ctx.lineTo(f,-d);this.ctx.closePath();this.ctx.fillStyle=this.lgrad(this.conf.colors.needle.start,this.conf.colors.needle.end,b-d);this.ctx.fill();this.ctx.beginPath();this.ctx.lineTo(-.5,b);this.ctx.lineTo(-1,b);this.ctx.lineTo(-e,0);this.ctx.lineTo(-f,-d);this.ctx.lineTo(f/2-2,-d);this.ctx.closePath();this.ctx.fillStyle="rgba(255, 255, 255, 0.2)";this.ctx.fill();this.ctx.restore();k;this.ctx.beginPath();this.ctx.arc(0,0,a,0,
2*Math.PI,!0);this.ctx.fillStyle=this.lgrad("#f0f0f0","#ccc",a);this.ctx.fill();this.ctx.restore();this.ctx.beginPath();this.ctx.arc(0,0,c,0,2*Math.PI,!0);this.ctx.fillStyle=this.lgrad("#e8e8e8","#f5f5f5",c);this.ctx.fill()},formatMajorTickNumber:function(a){var c;a=0===this.conf.majorTicksFormat.dec?Math.circle(a).toString():a.toFixed(this.conf.majorTicksFormat.dec);return 1<this.conf.majorTicksFormat["int"]?(c=-1<a.indexOf("."),-1<a.indexOf("-")?"-"+(this.conf.majorTicksFormat["int"]+this.conf.majorTicksFormat.dec+
2+(c?1:0)-a.length)+a.replace("-",""):""+(this.conf.majorTicksFormat["int"]+this.conf.majorTicksFormat.dec+1+(c?1:0)-a.length)+a):a},drawMajorTicks:function(){var a=this.max/100*81;this.ctx.lineWidth=2;this.ctx.strokeStyle=this.conf.colors.majorTicks;this.ctx.save();if(0===this.conf.majorTicks.length){for(var c=(this.conf.maxValue-this.conf.minValue)/5,b=0;5>b;b++)this.conf.majorTicks.push(formatMajorTickNumber(this.conf.minValue+c*b));this.conf.majorTicks.push(this.formatMajorTickNumber(this.conf.maxValue))}for(b=
0;b<this.conf.majorTicks.length;++b){if(""==this.conf.shape||"circle"==this.conf.shape||"rectangle"==this.conf.shape)var d=45+270/(this.conf.majorTicks.length-1)*b;else"semicircle"==this.conf.shape&&(d=90+180/(this.conf.majorTicks.length-1)*b);this.ctx.rotate(this.radians(d));this.ctx.beginPath();this.ctx.moveTo(0,a);this.ctx.lineTo(0,a-this.max/100*15);this.ctx.stroke();this.ctx.restore();this.ctx.save()}this.conf.strokeTicks&&(this.ctx.rotate(this.radians(90)),this.ctx.beginPath(),""==this.conf.shape||
"circle"==this.conf.shape||"rectangle"==this.conf.shape?this.ctx.arc(0,0,a,this.radians(45),this.radians(315),!1):"semicircle"==this.conf.shape&&this.ctx.arc(0,0,a,this.radians(90),this.radians(270),!1),this.ctx.stroke(),this.ctx.restore(),this.ctx.save())},drawMinorTicks:function(){var a=this.max/100*81;this.ctx.lineWidth=1;this.ctx.strokeStyle=this.conf.colors.minorTicks;this.ctx.save();for(var c=this.conf.minorTicks*(this.conf.majorTicks.length-1),b=0;b<c;++b){if(""==this.conf.shape||"circle"==
this.conf.shape||"rectangle"==this.conf.shape)var d=45+270/c*b;else"semicircle"==this.conf.shape&&(d=90+180/c*b);this.ctx.rotate(this.radians(d));this.ctx.beginPath();this.ctx.moveTo(0,a);this.ctx.lineTo(0,a-this.max/100*7.5);this.ctx.stroke();this.ctx.restore();this.ctx.save()}},drawNumbers:function(){for(var a=this.max/100*55,c=0;c<this.conf.majorTicks.length;++c){if(""==this.conf.shape||"circle"==this.conf.shape||"rectangle"==this.conf.shape)var b=45+270/(this.conf.majorTicks.length-1)*c;else"semicircle"==
this.conf.shape&&(b=90+180/(this.conf.majorTicks.length-1)*c);var d=this.rpoint(a,this.radians(b));this.ctx.font=this.max/200*20+"px Arial";this.ctx.fillStyle=this.conf.colors.numbers;this.ctx.lineWidth=0;this.ctx.textAlign="center";this.ctx.fillText(this.conf.majorTicks[c],d.x,d.y+3)}},drawTitle:function(){this.conf.title&&(this.ctx.save(),this.ctx.font=this.max/200*24+"px Arial",this.ctx.fillStyle=this.conf.colors.title,this.ctx.textAlign="center",this.ctx.fillText(this.conf.title,0,-this.max/4.25),
this.ctx.restore())},drawUnits:function(){this.conf.units&&(this.ctx.save(),this.ctx.font=this.max/200*22+"px Arial",this.ctx.fillStyle=this.conf.colors.units,this.ctx.textAlign="center",this.ctx.fillText(this.conf.units,0,this.max/3.25),this.ctx.restore())},padValue:function(a){var c=this.conf.valueFormat.dec,b=this.conf.valueFormat["int"];a=parseFloat(a);var d=0>a;a=Math.abs(a);if(0<c){a=a.toFixed(c).toString().split(".");c=0;for(b-=a[0].length;c<b;++c)a[0]="0"+a[0];a=(d?"-":"")+a[0]+"."+a[1]}else{a=
Math.circle(a).toString();c=0;for(b-=a.length;c<b;++c)a="0"+a;a=(d?"-":"")+a}return a},rpoint:function(a,c){var b=Math.sin(c),d=Math.cos(c);return{x:0*d-a*b,y:0*b+a*d}},circleRect:function(a,c,b,d,e){this.ctx.beginPath();this.ctx.moveTo(a+e,c);this.ctx.lineTo(a+b-e,c);this.ctx.quadraticCurveTo(a+b,c,a+b,c+e);this.ctx.lineTo(a+b,c+d-e);this.ctx.quadraticCurveTo(a+b,c+d,a+b-e,c+d);this.ctx.lineTo(a+e,c+d);this.ctx.quadraticCurveTo(a,c+d,a,c+d-e);this.ctx.lineTo(a,c+e);this.ctx.quadraticCurveTo(a,c,
a+e,c);this.ctx.closePath()},drawValueBox:function(){this.ctx.save();this.ctx.font=this.max/200*40+"px Led";if(""==this.conf.shape||"circle"==this.conf.shape||"rectangle"==this.conf.shape)var a=this.padValue(this.value),c=this.ctx.measureText("-"+this.padValue(0)).width,b=this.max-this.max/100*33,d=0,e=.12*this.max;else"semicircle"==this.conf.shape&&(a=this.padValue(this.value),c=this.ctx.measureText("-"+this.padValue(0)).width,b=this.max-this.max/100*45,d=0,e=.12*this.max);this.ctx.save();this.circleRect(-c/
2-.025*this.max,b-e-.04*this.max,c+.05*this.max,e+.07*this.max,.025*this.max);c=this.ctx.createRadialGradient(d,b-.12*this.max-.025*this.max+(.12*this.max+.045*this.max)/2,this.max/10,d,b-.12*this.max-.025*this.max+(.12*this.max+.045*this.max)/2,this.max/5);c.addColorStop(0,"#888");c.addColorStop(1,"#666");this.ctx.strokeStyle=c;this.ctx.lineWidth=.05*this.max;this.ctx.stroke();this.ctx.shadowBlur=.012*this.max;this.ctx.shadowColor="rgba(0, 0, 0, 1)";this.ctx.fillStyle="#babab2";this.ctx.fill();this.ctx.restore();
this.ctx.shadowOffsetX=.004*this.max;this.ctx.shadowOffsetY=.004*this.max;this.ctx.shadowBlur=.012*this.max;this.ctx.shadowColor="rgba(0, 0, 0, 0.3)";this.ctx.fillStyle="#444";this.ctx.textAlign="center";this.ctx.fillText(a,-d,b);this.ctx.restore()}});f._addWidget("gauge",f.widget.gauge)})(naw,jQuery);